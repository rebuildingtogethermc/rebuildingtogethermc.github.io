<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    .collapsible {
      background-color: #E5E5E5;
      color: black;
      border: 2px solid white;
      border-radius: 8px;
      cursor: pointer;
      padding: 18px;
      width: 100%;
      text-align: left;
      outline: none;
      font-size: 15px;
    }

    .active, .collapsible:hover {
      background-color: #00000;
    }

    .content {
      padding-top: 18px;
      padding-left: 18px;
      padding-bottom: 18px;
      display: none;
      overflow: hidden;
      font-size: 18px;
      line-height: 1.6;
    }

    .textbox {
      width: 100%;
      height: 20px;
    }
  </style>
</head>

<script type="text/javascript">

  function WriteToDownload(formInput) {

    var headerInfo = "Assesment 1 Form Response\nRebuilding Together Montgomery County\n\n";

    var initialInput = generateInitialInput(formInput);
    var file_name = generateFileName(formInput);

    var tableHeadings = "\nLocation:,Concern:,Notes:\n";

    var mainInput = generateMainInput(document.getElementById("allCollapsible"));

    var formOutput = headerInfo + initialInput + tableHeadings + mainInput;
    download_text_file(formOutput, file_name);
  }

  function generateInitialInput(formInput) {
    /*
    formInput (HTML): The HTML inside the <form> tags.

    Returns the header information in the form:
    name1: value1,
    name2: value2
    ...

    for all tags with the class="initialInputClass"
      */
    var initialFields = formInput.getElementsByClassName("initialInputClass");

    var outputText = "";
    for (var i=0; i<initialFields.length; i++) {
      outputText += initialFields[i].name + ":," + initialFields[i].value + "\n";
    }
    return(outputText)
  }

  function generateFileName(formInput) {
    var file_name = "A1 Form Response - " + document.getElementById("homeowner").value + ".csv";
    return(file_name)
  }

  function download_text_file(text_content, file_name="A1 Form Response.csv") {
    /*
    text_content (string): The text that you want downloaded.
    file_name (string): The file name of the download.

    This function downloads the text_content in a file named file_name
    */
    var content_to_download = text_content;

    document.write(content_to_download);

    var hiddenElement = document.createElement('a');
    hiddenElement.href = 'data:text/csv;charset=utf-8,' + encodeURI(content_to_download);
    hiddenElement.target = '_blank';
    
    //provide the name for the CSV file to be downloaded
    hiddenElement.download = file_name;
    hiddenElement.click();
  }

  function generateMainInput(allCollapsibles) {
    /*
    allCollapsibles (HTML): html inside <div id="allCollapsibles">

    Iterates through each collapsible section and extracts the sectionname, checkbox, and textbox info.
    */
    var collapsibleSections = allCollapsibles.getElementsByClassName("content");
    var outputText = "";

    for (var i=0; i<collapsibleSections.length; i++) {
      outputText += generateCollapsibleSectionInput(collapsibleSections[i], collapsibleSections[i].getAttribute("name"));
    }
    return(outputText)
  }

  function generateCollapsibleSectionInput(collapsibleSection, sectionName) {
    /*
    collapsibleSection (HTML): html inside <div class="content">
    sectionName (string):

    Returns the inputted form data as a csv:
    sectionName, checkboxvalue, textboxvalue
    */
    var sectionFields = collapsibleSection.getElementsByTagName("input");
    
    var outputText = "";
    var checkboxes = [];
    var textboxes = [];
    for (var i=0; i < sectionFields.length; i++) {
      if(i % 2==0){
        checkboxes.push(sectionFields[i]);
      }else{
        textboxes.push(sectionFields[i]);
      }
    }

    for (var j=0; j < checkboxes.length; j++) {
      if(checkboxes[j].checked==true) {
        outputText += sectionName + "," + checkboxes[j].value + "," + textboxes[j].value + "\n";
      }
    }
    return(outputText)

  }

</script>


<body>

  <h2>Assessment 1 Form</h2>

  <h3>Rebuilding Together Montgomery County</h4><br>

  <form>
    <label for="name">Name:</label><br>
    <input type="text" id="name" name="Name" class="initialInputClass"><br>
    <label for="date">Date:</label><br>
    <input type="text" id="date" name="Date" class="initialInputClass"><br>
    <label for="homeowner">Homeowner:</label><br>
    <input type="text" id="homeowner" name="Homeowner" class="initialInputClass"><br>
    <label for="address">Address:</label><br>
    <input type="text" id="address" name="Address" class="initialInputClass"><br><br>

    <div id="allCollapsible" data-role="collapsible">


      <button type="button" name="Kitchen" class="collapsible">Kitchen</button>
      <div class="content" name="Kitchen">
        <input type="checkbox" id="concernKitchen1" value="Sink" onchange="javascript:toggleOtherTextboxVisible('concernKitchen1', 'TextBoxKitchen1')" />
        <label for="concernKitchen1"> Sink</label><br>   
        <input id="TextBoxKitchen1" type="text" style="display:none" class="textbox"/>
        <input type="checkbox" id="concernKitchen2" value="Appliances" onchange="javascript:toggleOtherTextboxVisible('concernKitchen2', 'TextBoxKitchen2')" />
        <label for="concernKitchen2"> Appliance</label><br>
        <input id="TextBoxKitchen2" type="text" style="display:none" class="textbox"/> 
        <input type="checkbox" id="concernKitchen3" value="Windows" onchange="javascript:toggleOtherTextboxVisible('concernKitchen3', 'TextBoxKitchen3')" />
        <label for="concernKitchen3"> Windows</label><br>
        <input id="TextBoxKitchen3" type="text" style="display:none" class="textbox"/>
      </div>

      <button type="button" name="Bathroom" class="collapsible">Bathroom</button>
      <div class="content" name="Bathroom">
        <input type="checkbox" id="concernBathroom1" value="Grab bar" onchange="javascript:toggleOtherTextboxVisible('concernBathroom1', 'TextBoxBathroom1')" />
        <label for="concernBathroom1"> Grab bar</label><br>   
        <input id="TextBoxBathroom1" type="text" style="display:none" class="textbox"/>
        <input type="checkbox" id="concernBathroom2" value="Toilet" onchange="javascript:toggleOtherTextboxVisible('concernBathroom2', 'TextBoxBathroom2')" />
        <label for="concernBathroom2"> Toilet</label><br>
        <input id="TextBoxBathroom2" type="text" style="display:none" class="textbox"/> 
        <input type="checkbox" id="concernBathroom3" value="Shower" onchange="javascript:toggleOtherTextboxVisible('concernBathroom3', 'TextBoxBathroom3')" />
        <label for="concernBathroom3"> Shower</label><br>
        <input id="TextBoxBathroom3" type="text" style="display:none" class="textbox"/>
      </div>

      <button type="button" name="Exterior" class="collapsible">Exterior</button>
      <div class="content" name="Exterior">
        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
      </div>

      <div>
        <br>
        <input type="button" value="submit" onclick="WriteToDownload(this.form)">
      </div>

    </form>

    <script>
//Collapsible Javascript
var coll = document.getElementsByClassName("collapsible");
var i;

for (i = 0; i < coll.length; i++) {
  coll[i].addEventListener("click", function() {
    this.classList.toggle("active");
    var content = this.nextElementSibling;
    if (content.style.display === "block") {
      content.style.display = "none";
    } else {
      content.style.display = "block";
    }
  });
}


//Toggle Textbox Javascript
function toggleOtherTextboxVisible(checkbox_id, textbox_id)
{
  var check = document.getElementById(checkbox_id);
  if (check.checked) {
    document.getElementById(textbox_id).style.display = 'block';
  }
  else
    document.getElementById(textbox_id).style.display = 'none';                
}
</script>

</body>
</html>


